<img width="1736" height="1156" alt="image" src="https://github.com/user-attachments/assets/e94f4904-7197-461e-9029-ef22ccf96781" />


```plantuml
@startuml
actor "Инвестор" as Investor
actor "Эксперт" as Expert
participant "UI" as UI
participant "GrantStatisticsFacade" as Facade
participant "IStatisticsRepository" as StatsRepo
participant "IGrantApplicationRepository" as AppRepo
participant "AuthorizationService" as AuthService
participant "Database" as DB

== Получение общей статистики ==

Investor -> UI: Запрос статистики грантов
UI -> Facade: GetStatistics(filters: StatisticsFilters)
Facade -> AuthService: ValidateAccess(userId: uInt32, role: "Investor")
AuthService --> Facade: AccessGranted

Facade -> StatsRepo: GetGeneralStatistics(filters: StatisticsFilters)
StatsRepo -> DB: SELECT COUNT(*), status, funding_data\nFROM grant_applications WHERE filters
DB --> StatsRepo: Statistics data
StatsRepo --> Facade: Statistics object

Facade -> UI: Statistics data
UI --> Investor: Отображает статистику

== Получение экспертной статистики ==

Expert -> UI: Запрос своей статистики
UI -> Facade: GetExpertStatistics(expertId: uInt32)
Facade -> AuthService: ValidateAccess(expertId: uInt32, role: "Expert")
AuthService --> Facade: AccessGranted

Facade -> StatsRepo: GetExpertStatistics(expertId: uInt32)
StatsRepo -> DB: SELECT workload, review_time, efficiency\nFROM grant_applications WHERE expert_id = expertId
DB --> StatsRepo: Expert statistics
StatsRepo --> Facade: ExpertStatistics object

Facade -> UI: ExpertStatistics data
UI --> Expert: Отображает персональную статистику

== Генерация отчета ==

Investor -> UI: Запрос отчета
UI -> Facade: GenerateReport(filters: StatisticsFilters, format: ReportFormat)
Facade -> StatsRepo: CreateReport(filters, format)
StatsRepo -> DB: Сбор данных для отчета
DB --> StatsRepo: Report data
StatsRepo --> Facade: ReportFile object

Facade -> UI: ReportFile
UI --> Investor: Предлагает скачать отчет

@enduml
```plantuml
