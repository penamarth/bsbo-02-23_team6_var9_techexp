<img width="2558" height="2265" alt="image" src="https://github.com/user-attachments/assets/fb208fc0-4e79-4d18-b489-d99ea548c6f5" />


```plantuml
@startuml
skinparam sequence {
  ParticipantBackgroundColor #F5F5F5
  ActorBackgroundColor #E8F5E8
  LifeLineBackgroundColor #FFFFFF
  ArrowColor #444444
}

title Sequence Diagram: Grant Statistics

actor "Applicant" as Applicant
actor "Expert" as Expert
actor "Investor" as Investor
participant "GrantSystemUI" as UI
participant "GrantSystemFacade" as Facade
participant "IStatsService" as StatsService
participant "IAppRepository" as AppRepo
participant "IGrantRepository" as GrantRepo
participant "IUserRepository" as UserRepo
database "Database" as DB

' ========== СОИСКАТЕЛЬ: ОБЩАЯ СТАТИСТИКА ==========
Applicant -> UI : request general statistics
activate Applicant

UI -> Facade : getApplicationStats()
activate UI

Facade -> StatsService : getApplicationStats()
activate Facade

' Количество всех заявок
StatsService -> AppRepo : countAll()
activate StatsService

AppRepo -> DB : SELECT COUNT(*) FROM applications
activate AppRepo
DB --> AppRepo : totalCount=156
deactivate AppRepo

' Количество одобренных заявок
StatsService -> AppRepo : countByStatus('APPROVED')
activate StatsService

AppRepo -> DB : SELECT COUNT(*) FROM applications WHERE status = 'APPROVED'
activate AppRepo
DB --> AppRepo : approvedCount=42
deactivate AppRepo

' Общая сумма финансирования
StatsService -> GrantRepo : sumAmount()
activate StatsService

GrantRepo -> DB : SELECT SUM(amount) FROM grants
activate GrantRepo
DB --> GrantRepo : totalAmount=1250000
deactivate GrantRepo

' Средний балл оценок
StatsService -> AppRepo : calculateAverageScore()
activate StatsService

AppRepo -> DB : SELECT AVG(score) FROM reviews
activate AppRepo
DB --> AppRepo : avgScore=8.2
deactivate AppRepo

' Формирование статистики
StatsService -> StatsService : create ApplicationStats()
activate StatsService
note right: ApplicationStats {\n  total: 156,\n  approved: 42,\n  totalAmount: 1250000,\n  avgScore: 8.2\n}
deactivate StatsService

StatsService --> Facade : ApplicationStats
deactivate StatsService

Facade --> UI : ApplicationStats
deactivate Facade

UI --> Applicant : display general statistics
activate UI
note left Applicant: Общая статистика системы
deactivate UI
deactivate Applicant

' ========== ЭКСПЕРТ: ПЕРСОНАЛЬНАЯ СТАТИСТИКА ==========
Expert -> UI : request personal statistics
activate Expert

UI -> Facade : getExpertStatistics(expertId=123)
activate UI

Facade -> StatsService : getExpertStats(expertId=123)
activate Facade

' Статистика эксперта
StatsService -> UserRepo : getExpertStats(expertId=123)
activate StatsService

UserRepo -> DB : SELECT COUNT(*), AVG(score) FROM reviews WHERE expert_id = 123
activate UserRepo
DB --> UserRepo : reviewsCount=28, avgScore=7.8
deactivate UserRepo

' Рейтинг среди экспертов
StatsService -> UserRepo : getExpertRanking(expertId=123)
activate StatsService

UserRepo -> DB : 
activate UserRepo
note right: SELECT rank FROM (\n  SELECT expert_id,\n    RANK() OVER (ORDER BY COUNT(*) DESC) as rank\n  FROM reviews\n  GROUP BY expert_id\n) WHERE expert_id = 123
DB --> UserRepo : ranking=5
deactivate UserRepo

' Формирование статистики эксперта
StatsService -> StatsService : create ExpertStats()
activate StatsService
note right: ExpertStats {\n  reviewsCompleted: 28,\n  averageScore: 7.8,\n  ranking: 5/25\n}
deactivate StatsService

StatsService --> Facade : ExpertStats
deactivate StatsService

Facade --> UI : ExpertStats
deactivate Facade

UI --> Expert : display expert statistics
activate UI
note left Expert: Ваша персональная статистика
deactivate UI
deactivate Expert

' ========== ИНВЕСТОР: ФИНАНСОВАЯ СТАТИСТИКА ==========
Investor -> UI : request financial statistics
activate Investor

UI -> Facade : getGrantStatistics(investorId=456)
activate UI

Facade -> StatsService : getGrantStats(investorId=456)
activate Facade

' Инвестиционная статистика
StatsService -> GrantRepo : getInvestorStats(investorId=456)
activate StatsService

GrantRepo -> DB : SELECT COUNT(*), SUM(amount) FROM grants WHERE investor_id = 456
activate GrantRepo
DB --> GrantRepo : grantsCount=15, totalInvested=1250000
deactivate GrantRepo

' Средний размер инвестиций
StatsService -> GrantRepo : avgAmountByInvestor(investorId=456)
activate StatsService

GrantRepo -> DB : SELECT AVG(amount) FROM grants WHERE investor_id = 456
activate GrantRepo
DB --> GrantRepo : avgInvestment=83333
deactivate GrantRepo

' Статистика по соискателям
StatsService -> AppRepo : getUniqueApplicantsForInvestor(investorId=456)
activate StatsService

AppRepo -> DB : 
activate AppRepo
note right: SELECT COUNT(DISTINCT applicant_id)\nFROM applications a\nJOIN grants g ON a.id = g.application_id\nWHERE g.investor_id = 456
DB --> AppRepo : uniqueApplicants=12
deactivate AppRepo

' Формирование финансовой статистики
StatsService -> StatsService : create GrantStats()
activate StatsService
note right: GrantStats {\n  grantsFunded: 15,\n  totalInvested: 1250000,\n  avgInvestment: 83333,\n  uniqueApplicants: 12\n}
deactivate StatsService

StatsService --> Facade : GrantStats
deactivate StatsService

Facade --> UI : GrantStats
deactivate Facade

UI --> Investor : display financial statistics
activate UI
note left Investor: Ваша инвестиционная статистика
deactivate UI
deactivate Investor

@enduml
```plantuml
