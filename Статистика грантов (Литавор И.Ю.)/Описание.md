# Диаграмма последовательности: Получение статистики по грантам

## Рамки. 
Диаграмма показывает работу модуля статистики в рамках информационной системы технической экспертизы. Этот модуль обеспечивает автоматизированное формирование и предоставление статистических данных по грантовым программам для всех заинтересованных лиц системы.

## Уровень. 
Это пользовательская задача, подразумевающая запрос и получение агрегированных статистических данных о работе грантовой системы: от общих показателей до персональной аналитики.

## Основной исполнитель. 
Основные исполнители — три типа пользователей системы:
- Соискатель гранта (Applicant) — запрашивает общую статистику конкурса
- Независимый эксперт (Expert) — запрашивает персональную статистику своей экспертной деятельности
- Инвестор (Investor) — запрашивает финансовую статистику по программам

## Заинтересованные лица и их требования
- Соискатель гранта. Хочет видеть прозрачную статистику конкурса (количество заявок, процент одобрения, средний балл) для оценки своих шансов и принятия решения об участии.
- Независимый эксперт. Ожидает получить аналитику своей работы (количество проведенных экспертиз, средний балл, рейтинг среди коллег) для самооценки и планирования нагрузки.
- Инвестор. Заинтересован в детальной финансовой статистике (общая сумма финансирования, средний размер гранта, количество уникальных участников) для анализа эффективности вложений и планирования бюджета.

## Предусловия
- Пользователь зарегистрирован в системе как сущность User, прошёл аутентификацию через интерфейс и имеет соответствующую роль (Applicant, Expert или Investor).
- В системе существуют данные для статистического анализа (заявки, экспертизы, выданные гранты).
- Пользователь имеет права доступа к запрашиваемому типу статистики согласно своей роли.

## Результаты (Постусловия)
- Статистические данные корректно собраны и агрегированы из соответствующих репозиториев.
- Данные успешно переданы через фасад и отображены в пользовательском интерфейсе.
- Информация о запросе статистики учтена в системе мониторинга использования.

## Основной успешный сценарий
- Запрос статистики соискателем
  - Соискатель (Applicant) после входа в систему инициирует запрос общей статистики через пользовательский интерфейс.
  - UI вызывает операцию getApplicationStats() фасада GrantSystemFacade.
  - Facade делегирует запрос в StatsService.
  - StatsService выполняет серию запросов к репозиториям:
    - AppRepo.countAll() — получает общее количество заявок (156)
    - AppRepo.countByStatus('APPROVED') — получает количество одобренных заявок (42)
    - GrantRepo.sumAmount() — вычисляет общую сумму выданных грантов (1,250,000)
    - AppRepo.calculateAverageScore() — рассчитывает средний балл заявок (8.2)

StatsService формирует объект ApplicationStats с результатами.

Данные возвращаются через Facade в UI.

UI отображает статистику соискателю.

2. Запрос статистики экспертом

Эксперт (Expert) через интерфейс запрашивает персональную статистику.

UI вызывает getExpertStats(123) с ID эксперта.

Facade передает запрос в StatsService.

StatsService обращается к UserRepo:

UserRepo.getExpertStats(123) — получает количество экспертиз (28) и средний балл (7.8)

UserRepo.getExpertRanking(123) — определяет рейтинг эксперта (5)

Формируется объект ExpertStats.

Статистика возвращается и отображается эксперту.

3. Запрос статистики инвестором

Инвестор (Investor) запрашивает финансовую статистику по программе (ID: 456).

UI вызывает getGrantStats(456).

Facade направляет запрос в StatsService.

StatsService собирает данные:

GrantRepo.getInvestorStats(456) — количество грантов (15) и общая сумма (1,250,000)

GrantRepo.avgAmountByInvestor(456) — средний размер гранта (83,333)

AppRepo.getUniqueApplicants(456) — количество уникальных соискателей (12)

Создается объект GrantStats.

Статистика передается инвестору для отображения.

Статус статистики

Статистические данные всегда актуальны, так как рассчитываются на основе реальных данных из репозиториев в момент запроса.

Разные типы пользователей получают разные уровни детализации статистики согласно их ролям и правам доступа.

Обновление статистики

При каждом новом запросе статистика рассчитывается заново, обеспечивая актуальность данных.

Система кэширования может быть реализована для оптимизации частых запросов.

Специальные требования

Интерфейс отображения статистики должен быть интуитивно понятен: использовать графики, диаграммы и четкие цифровые показатели.

Обязательное шифрование передаваемых статистических данных (SSL/TLS), особенно финансовой информации.

Обеспечение высокой производительности при агрегации больших объемов данных.

Список технологий и типов данных

Типы данных: ApplicationStats (общая статистика), ExpertStats (статистика эксперта), GrantStats (финансовая статистика)

Данные: количественные показатели, финансовые суммы, рейтинги, средние значения

Интеграция с системами визуализации данных через API

Система аутентификации для контроля доступа к разным типам статистики

Частота использования

Высокая интенсивность использования статистического модуля:

Соискатели — в периоды подачи заявок для оценки конкурса

Эксперты — регулярно для мониторинга своей деятельности

Инвесторы — постоянно для анализа эффективности программ

Открытые вопросы

Требуется ли кэширование статистических данных для оптимизации производительности?

Нужна ли возможность настраиваемых отчетов для инвесторов?

Следует ли ограничивать частоту запросов статистики для предотвращения нагрузки на систему?

