[<img width="1791" height="2124" alt="image" src="https://github.com/user-attachments/assets/b1bc2845-2473-466a-8f56-753d7d6bc40e" />](http://www.plantuml.com/plantuml/png/pLVDRjD04BxxALOv9LBw0eXKBT1MaH12hIekN5nx2ujYhsLlKdAZBJy719KG4gSYeN95SX5MJTgwhp1-8sQpJffr4XE7eFOIsTwTcPtlc_bcin88qnTjfsK89bgKm0bSfQyWX9zm3X5SGWmHWJC8qoFyr8C4VXk6QGdkarNFQp7BT4NsllRIexum30yTCejvk48sVFpTwWQ2EjlDQIlhfcNQL5lT3gY_IJqUCFJSrPOmx9ILHromtUuMzJlCqjsjEIPhPGkhZvk6qMWG-0O99lOBml4iOz9e6CFyoDAodWYvGxX7tVi-DGNDjWd6tNNkEzMQeUzLndgkwC3A6rVDGRocNIVczS83KvWrOzm7EjPXGg-xpBNlTPlsgBEQaTksDEL8SjlaE1hck3CmExJgqZtbPYI9caHjXb1vEo8FtBGdfZcE_YWwYWGxirVCVe88QpXENoElFIJrBJuVbUCNCyoJ8sbfUxQCfb5IpBEoqFCjzbSClRAeBWvu503H3XeLnD7kOWLlqWwZUvKCog_fmL0G44e2b_YJVe1UkWzN4cPSZ-4iFVmxekqTXurZC2ECnTR5eEbjWKPpObMAe06itDK1FK4W8rIT12wKmghQJ0Z2cKWrIjz1X61E3gP9d8I5kdR_svY8o6QkFtL91RweibVqIIvZk4oFa3TyxH79RRgFR5v0aXxWcphIHpol7WoZvsGqYz__MXLyo7vTilM2MlYmm-rkRSvKQ7-U11i-RtigasD8C8zGx-MG86hd-6r2LRuldyMQYfhFGP7t8nz1HeyLgiarXWG1HNZnyH0_Xf9DvNRQ99ctAvxHszyIWr0ZLcMZFcI1kAlQQBdyX7Z2n7Db71YAXm9zKXi7yXnOtATrOd77eQwOXPHIZefX6mvPvMfMiDHkerYCvPOHGhRwOdKZfLV2Q4eH_MD5oBx-34b_nftA_fMQib01FeO84ZXDt_G5FeOBfLcva8iKt6BogLrY3fUwplW8Qd2JrvbRSWKfVotuBgSoX71Egh9APBqCPZ54jU89WiVmUOVEcrTcVki7oTZ_Za7LcGvlooQeP9dObLgfO_odgvP6usBxUmLtjPtM7m00)


```
@startuml
title Управление заявкой

actor Applicant
actor Expert

participant GrantSystemUI
participant GrantSystemFacade
participant UserRepository
participant AppRepository
participant NotifyService
participant EmailServiceAPI

== Создание заявки ==
Applicant -> GrantSystemUI : openCreateApplicationForm()
GrantSystemUI -> GrantSystemFacade : createApplication(applicantId, applicationData)
GrantSystemFacade -> UserRepository : findById(applicantId)
UserRepository --> GrantSystemFacade : User
GrantSystemFacade -> AppRepository : save(new GrantApplication)
AppRepository --> GrantSystemFacade : GrantApplication (appId)
GrantSystemFacade --> GrantSystemUI : applicationCreated(appId)

== Верификация заявки ==
Applicant -> GrantSystemUI : saveApplication(appId, updatedData)
GrantSystemUI -> GrantSystemFacade : updateGrantApplication(appId, updatedData)
GrantSystemFacade -> AppRepository : update(GrantApplication)
AppRepository --> GrantSystemFacade : GrantApplication (status="readyForReview")

== Отправка на экспертизу ==
Applicant -> GrantSystemUI : submitApplication(appId)
GrantSystemUI -> GrantSystemFacade : submitApplication(appId)
GrantSystemFacade -> AppRepository : findById(appId)
AppRepository --> GrantSystemFacade : GrantApplication
GrantSystemFacade -> AppRepository : update(status="onReview")

== Уведомления о подаче ==
GrantSystemFacade -> NotifyService : sendNotification(applicantUser,\n "Заявка принята к рассмотрению")
NotifyService -> EmailServiceAPI : sendEmail(toApplicant, subject, body)
GrantSystemFacade -> NotifyService : sendNotification(expertsGroup,\n "Новая заявка для экспертизы")
NotifyService -> EmailServiceAPI : sendEmail(toExperts, subject, body)

== Экспертиза и просмотр статуса ==
Expert -> GrantSystemUI : openApplication(appId)
GrantSystemUI -> GrantSystemFacade : getApplication(appId)
GrantSystemFacade -> AppRepository : findById(appId)
AppRepository --> GrantSystemFacade : GrantApplication
GrantSystemFacade -> AppRepository: findByApplicationId(appId)
AppRepository --> GrantSystemFacade : List<Review>
GrantSystemFacade --> GrantSystemUI : applicationWithReviews

Expert -> GrantSystemUI : submitReview(appId, score, comment)
GrantSystemUI -> GrantSystemFacade : submitReview(appId, score, comment)
GrantSystemFacade -> AppRepository: save(new Review)
AppRepository --> GrantSystemFacade : Review

Applicant -> GrantSystemUI : viewApplicationStatus(appId)
GrantSystemUI -> GrantSystemFacade : getApplication(appId)
GrantSystemFacade -> AppRepository : findById(appId)
GrantSystemFacade -> AppRepository : findByApplicationId(appId)
GrantSystemFacade --> GrantSystemUI : applicationWithReviews

== Доработка ==
GrantSystemFacade -> NotifyService : sendNotification(applicantUser,\n "Необходима доработка")
NotifyService -> EmailServiceAPI : sendEmail(toApplicant, subject, body)

Applicant -> GrantSystemUI : editApplication(appId)
GrantSystemUI -> GrantSystemFacade : updateGrantApplication(appId, revisedData)
GrantSystemFacade -> AppRepository : update(GrantApplication)
AppRepository --> GrantSystemFacade : GrantApplication
Applicant -> GrantSystemUI : submitApplication(appId)
GrantSystemUI -> GrantSystemFacade : submitApplication(appId)
GrantSystemFacade -> AppRepository : update(status="onReview")

== Финал (одобрение) ==
Expert -> GrantSystemUI : approveApplication(appId)
GrantSystemUI -> GrantSystemFacade : approveApplication(appId)
GrantSystemFacade -> AppRepository : findById(appId)
AppRepository --> GrantSystemFacade : GrantApplication
GrantSystemFacade -> AppRepository : save(new Grant(appId, amount, "approved"))
AppRepository --> GrantSystemFacade : Grant
GrantSystemFacade -> NotifyService : sendNotification(applicantUser,\n "Заявка одобрена")
NotifyService -> EmailServiceAPI : sendEmail(toApplicant, subject, body)
@enduml
```
