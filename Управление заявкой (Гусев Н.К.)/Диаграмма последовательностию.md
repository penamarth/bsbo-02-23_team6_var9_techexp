<img width="1507" height="2124" alt="image" src="https://github.com/user-attachments/assets/42542025-bdba-41b4-9c2b-958d0b9a0d70" />



```
@startuml
title Управление заявкой

actor Applicant
actor Expert

participant GrantSystemUI
participant GrantSystemFacade
participant UserRepository
participant AppRepository
participant NotifyService
participant EmailServiceAPI

== Создание заявки ==
Applicant -> GrantSystemUI : openCreateApplicationForm()
GrantSystemUI -> GrantSystemFacade : createApplication(applicantId, applicationData)
GrantSystemFacade -> UserRepository : findById(applicantId)
UserRepository --> GrantSystemFacade : User
GrantSystemFacade -> AppRepository : save(new GrantApplication)
AppRepository --> GrantSystemFacade : GrantApplication (appId)
GrantSystemFacade --> GrantSystemUI : applicationCreated(appId)

== Верификация заявки ==
Applicant -> GrantSystemUI : saveApplication(appId, updatedData)
GrantSystemUI -> GrantSystemFacade : updateGrantApplication(appId, updatedData)
GrantSystemFacade -> AppRepository : update(GrantApplication)
AppRepository --> GrantSystemFacade : GrantApplication (status="readyForReview")

== Отправка на экспертизу ==
Applicant -> GrantSystemUI : submitApplication(appId)
GrantSystemUI -> GrantSystemFacade : submitApplication(appId)
GrantSystemFacade -> AppRepository : findById(appId)
AppRepository --> GrantSystemFacade : GrantApplication
GrantSystemFacade -> AppRepository : update(status="onReview")

== Уведомления о подаче ==
GrantSystemFacade -> NotifyService : sendNotification(applicantUser,\n "Заявка принята к рассмотрению")
NotifyService -> EmailServiceAPI : sendEmail(toApplicant, subject, body)
GrantSystemFacade -> NotifyService : sendNotification(expertsGroup,\n "Новая заявка для экспертизы")
NotifyService -> EmailServiceAPI : sendEmail(toExperts, subject, body)

== Экспертиза и просмотр статуса ==
Expert -> GrantSystemUI : openApplication(appId)
GrantSystemUI -> GrantSystemFacade : getApplication(appId)
GrantSystemFacade -> AppRepository : findById(appId)
AppRepository --> GrantSystemFacade : GrantApplication
GrantSystemFacade --> GrantSystemUI : applicationWithReviews

== Создание Revie на грант ==
Expert -> GrantSystemUI : submitReview(appId, score, comment)
GrantSystemUI -> GrantSystemFacade : submitReview(appId, score, comment)
GrantSystemFacade -> AppRepository: update(new Review)
AppRepository --> GrantSystemFacade : Review
GrantSystemFacade --> GrantSystemUI : applicationWithReviews

== Доработка ==
GrantSystemFacade -> NotifyService : sendNotification(applicantUser,\n "Необходима доработка")
NotifyService -> EmailServiceAPI : sendEmail(toApplicant, subject, body)

Applicant -> GrantSystemUI : editApplication(appId)
GrantSystemUI -> GrantSystemFacade : updateGrantApplication(appId, revisedData)
GrantSystemFacade -> AppRepository : update(GrantApplication)
AppRepository --> GrantSystemFacade : GrantApplication
Applicant -> GrantSystemUI : submitApplication(appId)
GrantSystemUI -> GrantSystemFacade : submitApplication(appId)
GrantSystemFacade -> AppRepository : update(status="onReview")

== Финал (одобрение) ==
Expert -> GrantSystemUI : approveApplication(appId)
GrantSystemUI -> GrantSystemFacade : approveApplication(appId)
GrantSystemFacade -> AppRepository : findById(appId)
AppRepository --> GrantSystemFacade : GrantApplication
GrantSystemFacade -> AppRepository : update(GrantApplication)
AppRepository --> GrantSystemFacade : Grant
GrantSystemFacade -> NotifyService : sendNotification(applicantUser,\n "Заявка одобрена")
NotifyService -> EmailServiceAPI : sendEmail(toApplicant, subject, body)
@enduml
```
