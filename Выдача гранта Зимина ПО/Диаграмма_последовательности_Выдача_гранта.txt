@startuml
actor "Инвестор" as Investor
participant "UI" as UI
participant "GrantIssuanceFacade" as Facade
participant "AuthorizationService" as AuthService
participant "IGrantApplicationRepository" as AppRepo
participant "IApplicantRepository" as ApplicantRepo
participant "NotificationService" as NotifyService
participant "AccountingService" as AccountingService
participant "Database" as DB

Investor -> UI: Выдача гранта
UI -> Facade: ProcessGrantIssuance(applicationId: uint)

Facade -> AuthService: ValidateAccess(investorId: uint)
AuthService --> Facade: AccessGranted

Facade -> AppRepo: FindById(applicationId: uint)
AppRepo -> DB: SELECT * FROM grant_applications WHERE id = applicationId
DB --> AppRepo: Application data
AppRepo --> Facade: GrantApplication object

Facade -> ApplicantRepo: FindById(applicantId: uint)
ApplicantRepo -> DB: SELECT * FROM applicants WHERE id = applicantId
DB --> ApplicantRepo: Applicant data
ApplicantRepo --> Facade: Applicant object

Facade -> AccountingService: ProcessPayment(applicantId: uint, amount: decimal)
AccountingService -> DB: INSERT INTO payments (applicantId, amount, status)
DB --> AccountingService: Payment recorded
AccountingService --> Facade: Payment processed

Facade -> AppRepo: UpdateStatus(applicationId: uint, "GrantIssued")
AppRepo -> DB: UPDATE grant_applications SET status = 'GrantIssued'
DB --> AppRepo: Status updated
AppRepo --> Facade: Status updated

Facade -> NotifyService: Notify(applicantId, "Грант выплачен")
NotifyService --> Facade: Notification sent

Facade -> UI: Grant issuance completed
UI --> Investor: Грант успешно выдан
@enduml
