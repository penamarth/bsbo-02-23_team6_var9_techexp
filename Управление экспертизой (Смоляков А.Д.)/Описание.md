# Система управления грантами - Модуль экспертной оценки

## Обзор системы

Система управления грантами представляет собой многоуровневую архитектуру для автоматизации процесса подачи, рассмотрения и финансирования грантовых заявок. Модуль экспертной оценки является ключевым компонентом, обеспечивающим профессиональную оценку заявок независимыми экспертами.

## Архитектурные принципы

### 1. **Слоистая архитектура**
- **Презентационный слой (UI)**: GrantSystemUI — консольный интерфейс для взаимодействия
- **Фасадный слой**: GrantSystemFacade — единая точка входа для бизнес-логики
- **Сервисный слой**: Специализированные сервисы (NotifyService, StatsService)
- **Доменный слой**: Бизнес-сущности (User, GrantApplication, Review, Grant)
- **Инфраструктурный слой**: Репозитории для доступа к данным

### 2. **Принципы проектирования**
- **Инверсия зависимостей**: Зависимость от абстракций (интерфейсов), а не от реализаций
- **Разделение ответственности**: Каждый компонент имеет четко определенную зону ответственности
- **Агрегатная модель DDD**: `GrantApplication` — корень агрегата, `Review` — вложенная сущность

## Ключевые компоненты системы

### Доменные сущности

#### 1. **Пользователи и роли**
```csharp
BaseUser → Applicant (Заявитель)
         → Expert (Эксперт)
         → Investor (Инвестор)
```
- **Заявитель**: Подает заявки на гранты
- **Эксперт**: Проводит оценку заявок
- **Инвестор**: Финансирует одобренные проекты

#### 2. **Заявка на грант (GrantApplication)**
- Содержит информацию о проекте (название, описание)
- Имеет жизненный цикл статусов (Created → UNDER_REVIEW → Approved/Rejected)
- Включает список рецензий (`reviews`) как часть агрегата

#### 3. **Экспертная оценка (Review)**
- Содержит оценку (score) и комментарий эксперта
- Связана с конкретной заявкой (ApplicationId)
- Идентифицирует эксперта (ExpertId)
- Управляется только через `GrantApplication`

### Сервисные компоненты

#### 1. **GrantSystemFacade**
Центральный координатор системы, предоставляющий:
- Управление пользователями (логин/логаут)
- Работу с заявками (создание, отправка, просмотр)
- Экспертную оценку (получение заявок, отправка оценок)
- Утверждение грантов
- Получение статистики

#### 2. **Сервис уведомлений (NotifyService)**
- Отправка уведомлений пользователям о ключевых событиях
- Интеграция с внешними системами (EmailServiceAPI)

#### 3. **Сервис статистики (StatsService)**
- Сбор и анализ данных по заявкам
- Статистика по грантам и пользователям
- Использует данные из репозиториев

### Репозитории данных

#### 1. **IUserRepository**
- Управление данными пользователей
- Поиск по email для аутентификации
- CRUD операции над пользователями

#### 2. **IAppRepository**
- Работа с заявками на гранты
- Поиск по статусу для экспертов
- Загрузка и сохранение заявок **вместе с рецензиями**

## Процесс экспертной оценки

### Этап 1: Авторизация эксперта
1. Эксперт вводит учетные данные
2. Система проверяет роль пользователя
3. Предоставляется доступ к функциям эксперта

### Этап 2: Получение заявок для оценки
1. Эксперт запрашивает список заявок
2. Система возвращает заявки со статусом "UNDER_REVIEW"
3. Отображается список с базовой информацией

### Этап 3: Детальный просмотр заявки
1. Эксперт выбирает конкретную заявку
2. Загружается заявка **со всеми вложенными рецензиями**
3. Предоставляется полная информация для оценки

### Этап 4: Отправка экспертной оценки
1. Эксперт заполняет оценку и комментарий
2. Новая рецензия добавляется в список `reviews` заявки
3. Обновлённая заявка сохраняется через `IAppRepository`
4. Отправляется уведомление заявителю

### Этап 5: Завершение процесса
1. Статус заявки может быть обновлён
2. Данные передаются для дальнейшей обработки
3. Эксперт получает подтверждение
