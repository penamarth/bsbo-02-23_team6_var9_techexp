# Система управления грантами - Модуль экспертной оценки

## Обзор системы

Система управления грантами представляет собой многоуровневую архитектуру для автоматизации процесса подачи, рассмотрения и финансирования грантовых заявок. Модуль экспертной оценки является ключевым компонентом, обеспечивающим профессиональную оценку заявок независимыми экспертами.

## Архитектурные принципы

### 1. **Слоистая архитектура**
- **Презентационный слой (UI)**: GrantSystemUI - консольный интерфейс для взаимодействия
- **Фасадный слой**: GrantSystemFacade - единая точка входа для бизнес-логики
- **Сервисный слой**: Специализированные сервисы (NotifyService, StatsService, PaymentService)
- **Доменный слой**: Бизнес-сущности (User, GrantApplication, Review, Grant)
- **Инфраструктурный слой**: Репозитории для доступа к данным

### 2. **Принципы проектирования**
- **Инверсия зависимостей**: Зависимость от абстракций (интерфейсов), а не от реализаций
- **Разделение ответственности**: Каждый компонент имеет четко определенную зону ответственности
- **Принцип единой ответственности**: Классы выполняют только одну задачу

## Ключевые компоненты системы

### Доменные сущности

#### 1. **Пользователи и роли**
```csharp
BaseUser → Applicant (Заявитель)
         → Expert (Эксперт)
         → Investor (Инвестор)
```
- **Заявитель**: Подает заявки на гранты
- **Эксперт**: Проводит оценку заявок
- **Инвестор**: Финансирует одобренные проекты

#### 2. **Заявка на грант (GrantApplication)**
- Содержит информацию о проекте (название, описание)
- Имеет жизненный цикл статусов (Draft → Submitted → UnderReview → Approved/Rejected)
- Может получить несколько экспертных оценок

#### 3. **Экспертная оценка (Review)**
- Содержит оценку (score) и комментарий эксперта
- Связана с конкретной заявкой (ApplicationId)
- Идентифицирует эксперта (ExpertId)

### Сервисные компоненты

#### 1. **GrantSystemFacade**
Центральный координатор системы, предоставляющий:
- Управление пользователями (логин/логаут)
- Работу с заявками (создание, отправка, просмотр)
- Экспертную оценку (получение заявок, отправка оценок)
- Утверждение грантов
- Получение статистики

#### 2. **Сервис уведомлений (NotifyService)**
- Отправка уведомлений пользователям о ключевых событиях
- Интеграция с внешними системами (EmailServiceAPI)

#### 3. **Сервис статистики (StatsService)**
- Сбор и анализ данных по заявкам
- Статистика по грантам и пользователям
- Использует данные из репозиториев

### Репозитории данных

#### 1. **IUserRepository**
- Управление данными пользователей
- Поиск по email для аутентификации
- CRUD операции над пользователями

#### 2. **IAppRepository**
- Работа с заявками на гранты
- Поиск по статусу для экспертов
- Поиск заявок конкретного заявителя

#### 3. **IReviewRepository**
- Управление экспертными оценками
- Получение всех оценок для конкретной заявки
- Сохранение новых оценок

## Процесс экспертной оценки

### Этап 1: Авторизация эксперта
1. Эксперт вводит учетные данные
2. Система проверяет роль пользователя
3. Предоставляется доступ к функциям эксперта

### Этап 2: Получение заявок для оценки
1. Эксперт запрашивает список заявок
2. Система возвращает заявки со статусом "UNDER_REVIEW"
3. Отображается список с базовой информацией

### Этап 3: Детальный просмотр заявки
1. Эксперт выбирает конкретную заявку
2. Загружаются детали заявки и история оценок
3. Предоставляется полная информация для оценки

### Этап 4: Отправка экспертной оценки
1. Эксперт заполняет оценку и комментарий
2. Оценка сохраняется в системе
3. Пересчитывается средний балл заявки
4. Отправляется уведомление заявителю

### Этап 5: Завершение процесса
1. Статус заявки обновляется
2. Данные передаются для дальнейшей обработки
3. Эксперт получает подтверждение

## Технические особенности

### Обработка зависимостей
```csharp
// Внедрение зависимостей через конструктор
public GrantSystemFacade(
    IUserRepository userRepo,
    IAppRepository appRepo,
    IReviewRepository reviewRepo,
    INotifyService notify)
{
    // Инициализация зависимостей
}
```

### Управление состоянием заявок
- **Draft**: Черновик (еще не отправлен)
- **Submitted**: Отправлен на рассмотрение
- **UnderReview**: На экспертизе
- **Approved**: Одобрено
- **Rejected**: Отклонено
- **Funded**: Финансируется

### Безопасность и доступ
- Ролевая модель доступа
- Проверка прав при каждом действии
- Аудит всех операций

## Интеграции и расширения

### Внешние сервисы
1. **EmailServiceAPI**: Отправка email-уведомлений
2. **PaymentGatewayAPI**: Обработка финансовых транзакций
3. **ExpertiseServiceAPI** (планируется): Интеграция с внешними системами экспертизы

### Возможности расширения
1. **Коллективная экспертиза**: Несколько экспертов на одну заявку
2. **Верификация экспертов**: Дополнительная проверка квалификации
3. **Аналитика**: Расширенная статистика и отчетность
4. **Мобильный интерфейс**: Доступ с мобильных устройств

## Требования к качеству

### Производительность
- Быстрая загрузка списков заявок
- Оптимизированные запросы к базе данных
- Кэширование часто запрашиваемых данных

### Надежность
- Транзакционность критических операций
- Резервное копирование данных
- Мониторинг ошибок и сбоев

### Безопасность
- Шифрование чувствительных данных
- Защита от SQL-инъекций
- Валидация всех входных данных

## Руководство для разработчиков

### Начало работы
1. Клонировать репозиторий
2. Восстановить зависимости NuGet
3. Настроить строки подключения
4. Запустить миграции базы данных

### Структура решения
```
GrantSystem/           - Основное приложение
GrantSystem.Interfaces - Интерфейсы репозиториев и сервисов
GrantSystem.Repositories - Реализации репозиториев  
GrantSystem.Services   - Бизнес-сервисы
GrantSysytem.Domain    - Доменные сущности
```

### Правила кодирования
- Использовать camelCase для методов
- Четкие названия методов по их назначению
- Комментарии для сложной бизнес-логики
- Обработка исключений на всех уровнях

## Планы развития

### Краткосрочные
1. Реализация веб-интерфейса
2. Добавление системы шаблонов для экспертных оценок
3. Интеграция с системой документооборота

### Среднесрочные
1. Машинное обучение для предварительной оценки заявок
2. Мобильное приложение для экспертов
3. Система рейтинга экспертов

### Долгосрочные
1. Полная автоматизация грантового цикла
2. Блокчейн для верификации решений
3. Международная мультиязычная поддержка

## Заключение

Система управления грантами с модулем экспертной оценки представляет собой robust-решение для автоматизации процесса оценки грантовых заявок. Архитектура системы обеспечивает масштабируемость, безопасность и простоту поддержки, что делает ее готовой к внедрению в реальных условиях грантовых конкурсов.