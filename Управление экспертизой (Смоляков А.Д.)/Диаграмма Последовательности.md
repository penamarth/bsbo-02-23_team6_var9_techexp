<img width="2176" height="1695" alt="image" src="https://github.com/user-attachments/assets/175eca4c-0cf8-4da6-9759-6b4a5f2fafba" />



```
@startuml
skinparam sequence {
  ArrowColor #444444
  ActorBorderColor #666666
  ParticipantBorderColor #666666
  ParticipantBackgroundColor #F5F5F5
  LifeLineBackgroundColor #FFFFFF
}

title Процесс экспертной оценки заявки на грант

actor "Эксперт" as Expert <<User>>
participant "GrantSystemUI" as UI
participant "GrantSystemFacade" as Facade <<Facade>>
participant "IAppRepository" as AppRepo <<Interface>>
participant "IUserRepository" as UserRepo <<Interface>>
participant "INotifyService" as NotifyService <<Interface>>
participant "AppRepository" as AppRepoImpl <<Repository>>
participant "UserRepository" as UserRepoImpl <<Repository>>
participant "NotifyService" as NotifyServiceImpl <<Service>>
participant "Database" as DB

' 1. Авторизация
Expert -> UI: Вводит email/пароль
UI -> Facade: login(email, password)
Facade -> UserRepo: findByEmail(email)
UserRepo -> UserRepoImpl: findByEmail(email)
UserRepoImpl -> DB: SELECT * FROM users WHERE email = email
DB --> UserRepoImpl: Данные пользователя (User)
UserRepoImpl --> UserRepo: User object
UserRepo --> Facade: User object

alt Успешная авторизация и роль "Expert"
  Facade --> UI: User (с ролью Expert)
  UI --> Expert: Отображает дашборд эксперта
else Ошибка
  Facade --> UI: Ошибка авторизации
  UI --> Expert: Сообщение об ошибке
end

' 2. Получение списка заявок для оценки
Expert -> UI: Запрос списка заявок для экспертизы
UI -> Facade: getApplicationsForExpert(expertId)
Facade -> AppRepo: findByStatus("UNDER_REVIEW")
AppRepo -> AppRepoImpl: findByStatus("UNDER_REVIEW")
AppRepoImpl -> DB: SELECT * FROM grant_applications WHERE status = 'UNDER_REVIEW'
DB --> AppRepoImpl: Список заявок
AppRepoImpl --> AppRepo: List<GrantApplication>
AppRepo --> Facade: List<GrantApplication>
Facade --> UI: List<GrantApplicationDTO>
UI --> Expert: Отображает список заявок

' 3. Начало экспертизы (получение деталей заявки и рецензий)
Expert -> UI: Выбирает заявку для оценки
UI -> Facade: getApplicationReviews(appId)
Facade -> AppRepo: findById(appId)
AppRepo -> AppRepoImpl: findById(appId)
AppRepoImpl -> DB: SELECT * FROM grant_applications WHERE id = appId
DB --> AppRepoImpl: GrantApplication (включая вложенные reviews)
AppRepoImpl --> AppRepo: GrantApplication object
AppRepo --> Facade: GrantApplication
Facade --> UI: GrantApplicationDetails + List<Review>
UI --> Expert: Отображает форму заявки и историю оценок

' 4. Отправка результата экспертизы
Expert -> UI: Заполняет оценку (score) и комментарий (comment), нажимает "Отправить"
UI -> Facade: submitReview(appId, score, comment)
Facade -> AppRepo: findById(appId)
AppRepo --> Facade: GrantApplication
Facade -> GrantApplication: добавляет новый Review в список reviews
Facade -> AppRepo: update(grantApplication)
AppRepo -> AppRepoImpl: update(grantApplication)
AppRepoImpl -> DB: UPDATE grant_applications SET reviews = [...] WHERE id = appId
DB --> AppRepoImpl: OK
AppRepoImpl --> AppRepo: GrantApplication
AppRepo --> Facade: GrantApplication

' 5. Уведомление заявителя
Facade -> NotifyService: sendNotification(applicantId, "Получена новая экспертная оценка")
NotifyService -> NotifyServiceImpl: sendNotification(...)
NotifyServiceImpl --> Facade: void

Facade --> UI: подтверждение отправки
UI --> Expert: Сообщение "Экспертиза отправлена"
@enduml