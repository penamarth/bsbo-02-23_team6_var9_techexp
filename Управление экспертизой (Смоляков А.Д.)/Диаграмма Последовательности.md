<img width="2551" height="1405" alt="image" src="https://github.com/user-attachments/assets/2bcd4f82-4cb4-4b68-934a-9ab97cc4dd2e" />

```
@startuml
skinparam sequence {
  ArrowColor #444444
  ActorBorderColor #666666
  ParticipantBorderColor #666666
  ParticipantBackgroundColor #F5F5F5
  LifeLineBackgroundColor #FFFFFF
}

title Процесс экспертной оценки заявки на грант

actor "Эксперт" as Expert <<User>>
participant "GrantSystemUI" as UI
participant "GrantSystemFacade" as Facade <<Facade>>
participant "IAppRepository" as AppRepo <<Interface>>
participant "IReviewRepository" as ReviewRepo <<Interface>>
participant "IUserRepository" as UserRepo <<Interface>>
participant "INotifyService" as NotifyService <<Interface>>
participant "AppRepository" as AppRepoImpl <<Repository>>
participant "ReviewRepository" as ReviewRepoImpl <<Repository>>
participant "UserRepository" as UserRepoImpl <<Repository>>
participant "NotifyService" as NotifyServiceImpl <<Service>>
participant "Database" as DB

' 1. Авторизация
Expert -> UI: Вводит email/пароль
UI -> Facade: login(email, password)
Facade -> UserRepo: findByEmail(email)
UserRepo -> UserRepoImpl: findByEmail(email)
UserRepoImpl -> DB: SELECT * FROM users WHERE email = email
DB --> UserRepoImpl: Данные пользователя (User)
UserRepoImpl --> UserRepo: User object
UserRepo --> Facade: User object

alt Успешная авторизация и роль "Expert"
  Facade -> Expert: login(): boolean
  Expert --> Facade: true
  Facade --> UI: User (с ролью Expert)
  UI --> Expert: Отображает дашборд эксперта
else Ошибка
  Facade --> UI: Ошибка авторизации
  UI --> Expert: Сообщение об ошибке
end

' 2. Получение списка заявок для оценки
Expert -> UI: Запрос списка заявок для экспертизы
UI -> Facade: getApplicationsForExpert(expertId)
Facade -> AppRepo: findByStatus("UNDER_REVIEW")
AppRepo -> AppRepoImpl: findByStatus("UNDER_REVIEW")
AppRepoImpl -> DB: SELECT * FROM grant_applications WHERE status = 'UNDER_REVIEW'
DB --> AppRepoImpl: Список заявок
AppRepoImpl --> AppRepo: List<GrantApplication>
AppRepo --> Facade: List<GrantApplication>
Facade --> UI: List<GrantApplicationDTO>
UI --> Expert: Отображает список заявок

' 3. Начало экспертизы (получение деталей заявки)
Expert -> UI: Выбирает заявку для оценки
UI -> Facade: getApplicationReviews(appId)
Facade -> AppRepo: findById(appId)
AppRepo -> AppRepoImpl: findById(appId)
AppRepoImpl -> DB: SELECT * FROM grant_applications WHERE id = appId
DB --> AppRepoImpl: Данные заявки
AppRepoImpl --> AppRepo: GrantApplication object
AppRepo --> Facade: GrantApplication

Facade -> ReviewRepo: findByApplication(appId)
ReviewRepo -> ReviewRepoImpl: findByApplication(appId)
ReviewRepoImpl -> DB: SELECT * FROM reviews WHERE application_id = appId
DB --> ReviewRepoImpl: Список рецензий
ReviewRepoImpl --> ReviewRepo: List<Review>
ReviewRepo --> Facade: List<Review>

Facade --> UI: GrantApplicationDetails + List<ReviewDTO>
UI --> Expert: Отображает форму заявки и историю оценок

' 4. Отправка результата экспертизы
Expert -> UI: Заполняет оценку (score) и комментарий (comment), нажимает "Отправить"
UI -> Facade: submitReview(appId, score, comment)
Facade -> ReviewRepo: save(new Review(appId, expertId, score, comment))
ReviewRepo -> ReviewRepoImpl: save(review)
ReviewRepoImpl -> DB: INSERT INTO reviews (...) VALUES (...)
DB --> ReviewRepoImpl: ID созданной записи
ReviewRepoImpl --> ReviewRepo: Review object (сохраненный)
ReviewRepo --> Facade: Review object

Facade -> AppRepo: findById(appId)
AppRepo -> AppRepoImpl: findById(appId)
AppRepoImpl -> DB: SELECT * FROM grant_applications WHERE id = appId
DB --> AppRepoImpl: GrantApplication
AppRepoImpl --> AppRepo: GrantApplication
AppRepo --> Facade: GrantApplication

Facade -> GrantApplication: getAverageScore(): double
GrantApplication --> Facade: averageScore
Facade -> AppRepo: update(applicationData)
AppRepo -> AppRepoImpl: update(applicationData)
AppRepoImpl -> DB: UPDATE grant_applications SET ... WHERE id = appId
DB --> AppRepoImpl: OK
AppRepoImpl --> AppRepo: GrantApplication
AppRepo --> Facade: GrantApplication

' 5. Уведомление заявителя
Facade -> NotifyService: sendNotification(applicantUser, "Получена новая экспертная оценка")
NotifyService -> NotifyServiceImpl: sendNotification(...)
NotifyServiceImpl --> Facade: void

Facade --> UI: ReviewDTO (подтверждение отправки)
UI --> Expert: Сообщение "Экспертиза отправлена"
@enduml
```
