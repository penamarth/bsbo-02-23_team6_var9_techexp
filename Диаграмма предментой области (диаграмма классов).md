<img width="2125" height="1676" alt="image" src="https://github.com/user-attachments/assets/0ed255b4-c653-44ec-976e-83ee14a94071" />




```plantuml
@startuml
skinparam class {
    BackgroundColor<<Interface>> #E6F3FF
    BackgroundColor<<Entity>> #FFFFFF
    BackgroundColor<<Facade>> #E8F5E8
    BackgroundColor<<Repository>> #FFF4E6
    BackgroundColor<<Service>> #FFF0F5
    BorderColor #666666
    ArrowColor #444444
}

skinparam package {
    BackgroundColor<<Main>> #F5F5F5
    BackgroundColor<<Support>> #F0F8FF
    BorderColor #888888
}

class GrantSystemUI {
  + main()
  + showLoginScreen()
  + showDashboard()
  + showApplicationForm()
  + showReviewForm()
  + showStatistics()
}

package "Основной контекст" <<Main>> {

  class GrantSystemFacade <<Facade>> {
    + login(email, password): User
    + logout(): void
    + createApplication(applicationData): GrantApplication
    + submitApplication(appId): void
    + getMyApplications(): List<GrantApplication>
    + getApplicationsForExpert(): List<GrantApplication>
    + submitReview(appId, score, comment): Review
    + getApplicationReviews(appId): List<Review>
    + approveApplication(appId, amount): Grant
    + rejectApplication(appId, reason): void
    + getApplicationStats(): ApplicationStats
    + getGrantStats(): GrantStats
  }

  interface IUserRepository <<Interface>> {
    + findById(id): User
    + findByEmail(email): User
    + save(user): User
    + delete(user): void
  }
  
  interface IAppRepository <<Interface>> {
    + findById(id): GrantApplication
    + save(app): GrantApplication
    + delete(app): void
    + findByApplicant(id): List<GrantApplication>
    + findByStatus(status): List<GrantApplication>
    + update(app): GrantApplication
  }
  
  interface IReviewRepository <<Interface>> {
    + findById(id): Review
    + save(review): Review
    + findByApplication(id): List<Review>
    + findByApplicant(id): List<Review>
  }
  
  interface IGrantRepository <<Interface>> {
    + findById(id): Grant
    + save(grant): Grant
    + findByInvestor(id): List<Grant>
  }

  class UserRepository <<Repository>> implements IUserRepository {
    - database
  }
  
  class AppRepository <<Repository>> implements IAppRepository {
    - database
  }
  
  class ReviewRepository <<Repository>> implements IReviewRepository {
    - database
  }
  
  class GrantRepository <<Repository>> implements IGrantRepository {
    - database
  }

  package "Агрегат User" {
    class User <<Entity>> {
      + id
      + name
      + email
      + role
      - passwordHash
      + login(): boolean
      + logout(): void
    }
    
    class Applicant <<Entity>> {
      + organization
      + inn
    }
    
    class Expert <<Entity>> {
      + specialty
      + qualification
    }
    
    class Investor <<Entity>> {
      + company
      + budget
    }
    
    User <|-- Applicant
    User <|-- Expert
    User <|-- Investor
  }

  class GrantApplication <<Entity>> {
      + id
      + title
      + description
      + status
      + submissionDate
      + submit(): void
      + getAverageScore(): double
   }

  class Review <<Entity>> {
      + id
      + score
      + comment
      + submissionDate
      + applicationId
      + expertId
      + submit(): void
   }

  class Grant <<Entity>> {
      + id
      + amount
      + startDate
      + endDate
      + status
      + approve(): void
      + disburse(): boolean
    }

  GrantSystemFacade --> IUserRepository
  GrantSystemFacade --> IAppRepository
  GrantSystemFacade --> IReviewRepository
  GrantSystemFacade --> IGrantRepository

  IUserRepository --> User
  IAppRepository --> GrantApplication
  IReviewRepository --> Review
  IGrantRepository --> Grant
}

package "Вспомогательный контекст" <<Support>> {
  
  interface INotifyService <<Interface>> {
    + sendNotification(message): void
  }
  
  interface IPaymentService <<Interface>> {
    + processPayment(grant): boolean
  }

  interface IStatsService <<Interface>> {
    + getApplicationStats(): ApplicationStats
    + getGrantStats(): GrantStats
    + getUserStats(): UserStats
  }

  class StatsService <<Service>> implements IStatsService {
    - appRepo: IAppRepository
    - userRepo: IUserRepository
    - grantRepo: IGrantRepository
  }
  
  class NotifyService <<Service>> implements INotifyService {
    - database
  }
  
  class PaymentService <<Service>> implements IPaymentService {
    - paymentGatewayAPI
  }

  package "ВНЕШНИЕ API" {
    class EmailServiceAPI {
      + sendEmail(to, subject, body): boolean
    }
  
    class PaymentGatewayAPI {
      + processPayment(amount, recipient): Result
    }
  }

  NotifyService --> EmailServiceAPI
  PaymentService --> PaymentGatewayAPI
  StatsService --> IAppRepository
  StatsService --> IUserRepository
  StatsService --> IGrantRepository
}

GrantSystemUI ..> GrantSystemFacade : вызывает

GrantSystemFacade --> INotifyService
GrantSystemFacade --> IPaymentService
GrantSystemFacade --> IStatsService

Applicant "1" --> "*" GrantApplication : создает
Expert "1" --> "*" Review : пишет
Investor "1" --> "*" Grant : финансирует
GrantApplication "1" --> "*" Review : содержит
GrantApplication "1" --> "0..1" Grant : порождает

hide empty members
hide circle
@enduml
```
